<div
  id="cart-overlay"
  class="fixed inset-0 bg-black/20 backdrop-blur-sm z-[100] opacity-0 pointer-events-none transition-opacity duration-500"
></div>

<div
  id="cart-drawer"
  class="fixed top-0 right-0 h-full w-full md:w-[450px] bg-white text-[#1C1917] z-[101] transform translate-x-full transition-transform duration-500 ease-[cubic-bezier(0.22,1,0.36,1)] shadow-2xl flex flex-col border-l border-[#D6D3D1]"
>
  <div class="p-6 border-b-2 border-dashed border-[#A8A29E] bg-[#F5F5F4]">
    <div class="flex justify-between items-start mb-4">
      <h2 class="text-2xl font-bold uppercase tracking-tighter">Invoice</h2>
      <button id="close-cart" class="text-xs font-mono uppercase hover:text-[#EA580C]">[Close]</button>
    </div>

    <div class="space-y-1 text-[10px] font-mono uppercase tracking-widest text-[#78716C]">
      <p>DATE: <span id="receipt-date"></span></p>
      <p>ID: #{{ cart.item_count | default: '00' }}</p>
      <p>STATUS: PENDING</p>
    </div>
  </div>

  <div class="flex-grow overflow-y-auto p-6 space-y-6" id="cart-items-container">
    {% if cart.item_count > 0 %}
      <form action="{{ routes.cart_url }}" method="post" id="cart-form">
        <ul class="space-y-6">
          {% for item in cart.items %}
            <li class="flex gap-4 items-start pb-6 border-b border-dashed border-[#D6D3D1]">
              <div class="w-16 h-16 bg-[#F5F5F4] border border-[#D6D3D1] overflow-hidden shrink-0">
                {% if item.image %}
                  <img
                    src="{{ item.image | image_url: width: 100 }}"
                    class="w-full h-full object-cover grayscale"
                    alt="{{ item.title }}"
                  >
                {% endif %}
              </div>

              <div class="flex-grow">
                <div class="flex justify-between items-start">
                  <h3 class="text-sm font-bold uppercase tracking-tight leading-tight">{{ item.product.title }}</h3>
                  <span class="text-sm font-mono">{{ item.final_line_price | money }}</span>
                </div>

                <p class="text-[10px] font-mono text-[#78716C] uppercase mt-1">
                  {% unless item.product.has_only_default_variant %}
                    {{ item.variant.title }}
                  {% endunless %}
                </p>

                <div class="flex justify-between items-center mt-3">
                  <div class="flex items-center border border-[#D6D3D1]">
                    <a
                      href="/cart/change?line={{ forloop.index }}&quantity={{ item.quantity | minus: 1 }}"
                      class="px-2 py-1 hover:bg-[#1C1917] hover:text-white transition-colors"
                      >-</a
                    >
                    <span class="px-2 text-xs font-mono">{{ item.quantity }}</span>
                    <a
                      href="/cart/change?line={{ forloop.index }}&quantity={{ item.quantity | plus: 1 }}"
                      class="px-2 py-1 hover:bg-[#1C1917] hover:text-white transition-colors"
                      >+</a
                    >
                  </div>
                  <a
                    href="/cart/change?line={{ forloop.index }}&quantity=0"
                    class="text-[10px] font-mono uppercase text-[#78716C] hover:text-red-600 decoration-dashed underline underline-offset-4"
                  >
                    Remove
                  </a>
                </div>
              </div>
            </li>
          {% endfor %}
        </ul>
      </form>
    {% else %}
      <div class="h-full flex flex-col items-center justify-center text-[#A8A29E] space-y-4">
        <span class="text-4xl opacity-20">///</span>
        <p class="font-mono text-xs uppercase tracking-widest">No Items in Queue</p>
        <a
          href="/collections/all"
          class="text-xs font-bold uppercase border-b border-black text-black pb-1 hover:text-[#EA580C] hover:border-[#EA580C]"
        >
          Browse Archive
        </a>
      </div>
    {% endif %}
  </div>

  {% if cart.item_count > 0 %}
    <div class="p-6 bg-[#F5F5F4] border-t-2 border-dashed border-[#A8A29E]">
      <div class="space-y-2 mb-6 text-xs font-mono uppercase tracking-widest text-[#57534E]">
        <div class="flex justify-between">
          <span>Subtotal</span>
          <span>{{ cart.total_price | money }}</span>
        </div>
        <div class="flex justify-between opacity-50">
          <span>Shipping</span>
          <span>Calculated at Next Step</span>
        </div>
        <div class="flex justify-between opacity-50">
          <span>Taxes</span>
          <span>Calculated at Next Step</span>
        </div>
      </div>

      <div class="flex justify-between items-center border-t border-[#1C1917] pt-4 mb-6">
        <span class="text-sm font-bold uppercase">Total Due</span>
        <span class="text-xl font-mono font-bold">{{ cart.total_price | money }}</span>
      </div>

      <button
        type="submit"
        form="cart-form"
        name="checkout"
        class="w-full bg-[#1C1917] text-white py-4 font-bold uppercase tracking-[0.2em] hover:bg-[#EA580C] transition-colors flex justify-between px-6 group"
      >
        <span>Authorize Payment</span>
        <span class="group-hover:translate-x-1 transition-transform">â†’</span>
      </button>
    </div>
  {% endif %}
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // 1. Set Date
    const dateEl = document.getElementById('receipt-date');
    if (dateEl) {
      const now = new Date();
      dateEl.innerText = now.toLocaleDateString('en-US', { year: 'numeric', month: '2-digit', day: '2-digit' });
    }

    // 2. Drawer Logic
    const drawer = document.getElementById('cart-drawer');
    const overlay = document.getElementById('cart-overlay');
    const closeBtn = document.getElementById('close-cart');

    // Function to Open
    function openCart() {
      drawer.classList.remove('translate-x-full');
      overlay.classList.remove('opacity-0', 'pointer-events-none');
      document.body.style.overflow = 'hidden'; // Lock scroll
    }

    // Function to Close
    function closeCart() {
      drawer.classList.add('translate-x-full');
      overlay.classList.add('opacity-0', 'pointer-events-none');
      document.body.style.overflow = ''; // Unlock scroll
    }

    // Event Listeners
    if (closeBtn) closeBtn.addEventListener('click', closeCart);
    if (overlay) overlay.addEventListener('click', closeCart);

    // Hijack all "Cart" links to open drawer instead of going to page
    document.querySelectorAll('a[href="/cart"]').forEach((link) => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        openCart();
      });
    });

    // Check if URL has ?cart_open=true (e.g., after adding product)
    if (window.location.search.includes('cart_open=true')) {
      openCart();
    }
  });
</script>

{% schema %}
{ "name": "Invoice Drawer", "settings": [] }
{% endschema %}
